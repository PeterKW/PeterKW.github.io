<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Music Playlist Redirect</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: system-ui, sans-serif;
      text-align: center;
      padding-top: 60px;
    }
    .box {
      display: inline-block;
      background: #222;
      border: 1px solid #444;
      padding: 20px 30px;
      border-radius: 10px;
    }
  </style>
</head>

<body>
  <div class="box">
    <h2>üéµ Music Playlist Redirect</h2>
    <p id="status">Loading‚Ä¶</p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
  <script>
  (async () => {

    const status = msg => document.getElementById("status").innerText = msg;

    // 1Ô∏è‚É£ Read key from URL
    const params = new URLSearchParams(window.location.search);
    const key = params.get("key");

    if (!key) {
      status("Missing ?key=");
      return;
    }

    status("Loading playlists‚Ä¶");

    // 2Ô∏è‚É£ Load encrypted playlist list
    let playlists;
    try {
      const res = await fetch("playlists.json?cache=" + Date.now());
      playlists = await res.json();
    } catch (e) {
      status("Failed to load playlists.json");
      return;
    }

    // 3Ô∏è‚É£ Compute hash of key
    const keyhash = "SHA256:" + CryptoJS.SHA256(key).toString();

    // 4Ô∏è‚É£ Find entry by keyhash
    const entry = playlists.find(p => p.keyhash === keyhash);

    if (!entry) {
      status("Playlist not found");
      return;
    }

    status("Decrypting‚Ä¶");

    // 5Ô∏è‚É£ Correct decryption (NO salt/iv passed!)
    const MASTER_PASSWORD = "MusicPlaylistRedirect";

    let decrypted;
    try {
      const out = CryptoJS.AES.decrypt(entry.ciphertext, MASTER_PASSWORD);
      decrypted = out.toString(CryptoJS.enc.Utf8);
    } catch (e) {
      status("Decryption error.");
      return;
    }

    // 6Ô∏è‚É£ Validate decrypted URL
    if (!decrypted || !decrypted.startsWith("http")) {
      status("Decryption failed.");
      return;
    }

    status("Redirecting‚Ä¶");

    // 7Ô∏è‚É£ Redirect
    window.location.href = decrypted;

  })();
  </script>

</body>
  </html>
