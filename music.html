<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Music Playlist Redirect</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>

<body style="font-family: sans-serif; padding: 20px;">

<h2>Music Playlist Redirect</h2>
<p>Loading…</p>

<script>
// Get ?key=XXXX from URL
const params = new URLSearchParams(window.location.search);
const key = params.get("key");

if (!key) {
    document.body.innerHTML = "<h3>❌ No key provided.</h3>";
    throw new Error("Missing key");
}

// Compute SHA256 of key
function hashKey(input) {
    return "SHA256:" + CryptoJS.SHA256(input).toString();
}

const keyhash = hashKey(key);

// Load encrypted playlists.json
fetch("playlists.json")
    .then(r => r.json())
    .then(data => {
        const entry = data.find(e => e.keyhash === keyhash);

        if (!entry) {
            document.body.innerHTML = `<h3>❌ Playlist not found for key: ${key}</h3>`;
            return;
        }

        try {
            const salt = CryptoJS.enc.Base64.parse(entry.salt);
            const iv = CryptoJS.enc.Base64.parse(entry.iv);

            const decrypted = CryptoJS.AES.decrypt(entry.ciphertext, 
                MASTER_PASSWORD = "MusicPlaylistRedirect", 
                { iv, salt }
            ).toString(CryptoJS.enc.Utf8);

            if (!decrypted) {
                document.body.innerHTML = "<h3>❌ Decryption failed.</h3>";
                return;
            }

            // Success → Redirect to playlist URL
            window.location.href = decrypted.trim();

        } catch (err) {
            document.body.innerHTML = `<h3>❌ Error: ${err.message}</h3>`;
        }
    })
    .catch(err => {
        document.body.innerHTML = `<h3>❌ Failed to load playlist list.</h3>`;
        console.error(err);
    });
</script>

</body>
</html>
